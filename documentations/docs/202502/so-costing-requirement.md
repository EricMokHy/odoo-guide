# Odoo 客製化需求文件

## **1. 簡介**
本文件詳細說明 Odoo 17 客製化需求，以整合所有與實際成本相關的數據（如採購、支出、人力資源等），確保所有成本能夠在銷售訂單（SO）上查看，並最終生成損益報表。

## **2. 需求範圍**

### **2.1 影響的 Odoo 模組**
- **Order（Quotation、Sale Order）**
- **Purchase Order（PO）**
- **Invoice**
- **Expenses**
- **Project**
- **Timesheet**

### **2.2 需求詳情**

#### **2.2.0 目標（Objective）**
本次客製化的目標是將所有與銷售訂單（SO）相關的成本數據（採購、支出、人力資源等）整合，確保能夠從 SO 介面一站式查看所有成本，並最終產出支出報表，以提高決策效率與成本管理的透明度。


#### **2.2.1 修改現有功能**
1. **在 Purchase Order（PO） 上加入 Sale Order（SO）的關聯**  
      - **目的**：讓 PO 能夠關聯對應的 SO，確保採購與銷售訂單之間的透明度與可追溯性。
      - **期望結果**：使用者可以直接從 PO 查看關聯的 SO，提高工作效率。
      - **需修改細節**：
          - PO 模組需增加 SO 關聯字段。
          - 在 PO 詳細頁面新增 SO 連結區塊。

2. **在 Sale Order（SO） 上顯示相關的 PO**  
      - **目的**：讓 SO 使用者可以直接查閱所有相關的 PO，確保訂單成本透明。
      - **期望結果**：SO 介面顯示所有關聯 PO，並可點擊查看詳情。
      - **需修改細節**：
        - SO 模組新增 PO 關聯字段。
        - 在 SO 詳細頁面增加關聯 PO 顯示區塊及連結。

3. **在 Expenses 上加入 SO 的關聯**  
      - **目的**：確保與 SO 相關的費用能夠正確關聯，以利成本統計。
      - **期望結果**：Expenses 記錄能夠對應到特定的 SO，提高財務報表的準確性。
      - **需修改細節**：
        - Expenses 模組增加 SO 關聯字段。
        - 允許在 Expenses 詳細頁面選擇 SO。

4. **在 Sale Order（SO） 上顯示相關的 Expenses**  
      - **目的**：讓 SO 使用者可以查閱所有與該訂單相關的費用，增強成本控制。
      - **期望結果**：SO 介面顯示關聯的 Expenses，並可點擊查看詳情。
      - **需修改細節**：
        - 在 SO 詳細頁面增加 Expenses 顯示區塊。
        - 允許 Expenses 連結到 SO。

5. **在 Sale Order（SO） 上顯示相關的 Project Timesheet**  
      - **目的**：將人力成本透明化，確保所有工時記錄能夠關聯到 SO。
      - **期望結果**：SO 介面顯示所有相關的 Timesheet，並可點擊查看詳情。
      - **需修改細節**：
        - 在 SO 詳細頁面增加 Timesheet 顯示區塊。
        - 允許 Timesheet 連結到 SO。

6. **在 Sale Order（SO） 中增加支出報表**  
      - **目的**：提供 SO 總成本概覽，幫助決策者分析利潤與支出。
      - **期望結果**：SO 介面新增支出報表區塊，包含 PO、Expenses、Timesheet 數據。
      - **需修改細節**：
        - 在 SO 介面新增報表模組。
        - 整合 PO、Expenses、Timesheet 數據，支援視覺化圖表顯示成本結構。  
        - 報表應包含以下元素：  
            - 總採購成本（所有關聯 PO 的總金額）。
            - 總支出成本（所有關聯 Expenses 的總金額）。
            - 人力成本（關聯 Timesheet 記錄的工時與費用）。
            - 預估利潤（SO 總金額 - 總成本）。
            - 實際利潤（扣除所有支出後的最終利潤）。
            - 應收金額
            - 己收金額
            - 應付金額
            - 己付金額
            - 成本細項分析（不同類別的成本比例視覺化，如 Pie Chart）。
        - 在 SO 頁面新增可視化圖表，幫助管理者快速理解數據。
        - 允許導出報表（Excel / PDF 格式）。

7. **在 WeChat Mini App 上增加 Timesheet 支持**  
      - **目的**：讓員工可以在 WeChat Mini App 內直接填寫工時，提高錄入便利性。
      - **期望結果**：員工可透過 WeChat Mini App 記錄 Timesheet，並同步至 Odoo。
      - **需修改細節**：
        - WeChat Mini App 介面增加 Timesheet 記錄功能。
        - 確保提交的 Timesheet 可以同步到 Odoo。
        - 具體修改內容包括：
            - 在 Mini App 中新增 TimeSheet 頁簽。
            - 員工可在已分配給他且仍有效的 Task 列表中選擇一個 Task，並按 「開始」 按鈕記錄工時。
            - 當員工完成當天任務時，可按 「停止」 按鈕結束工時計算。
            - 數據應整合至 Timesheet 模組，確保記錄準確無誤。
            - 員工可透過 Mini App 查閱個人 Timesheet 紀錄，並篩選特定日期或專案的工時。
            - 同一時間內僅允許一筆「進行中」的工時記錄，未停止當前計時前，不可啟動新的計時。
            - 若員工遺漏「開始」或「停止」操作，其直屬上司可手動修改該次記錄，確保數據完整性。

### **2.3 數據模型修改**  

- **不新增新模型**，但需在相關表單中加入關聯字段。
- 關聯字段需支援查詢與篩選功能。

### **2.4 業務邏輯與自動化需求**
- **業務邏輯不變**，僅增加關聯字段。
- 新增的關聯字段為 **非必填項**。
- 自動生成報表的計算邏輯需確保數據準確。

## **3. 功能需求摘要**
| 功能 | 模組 | 需求描述 |
|---|---|---|
| PO 連結 SO | Purchase Order | PO 需增加關聯字段，允許從 PO 查看對應的 SO |
| SO 查看 PO | Sale Order | SO 需增加區塊顯示關聯的 PO，並可跳轉 |
| Expenses 連結 SO | Expenses | Expenses 需增加關聯字段，允許從 Expenses 查看對應的 SO |
| SO 查看 Expenses | Sale Order | SO 需增加區塊顯示關聯的 Expenses，並可跳轉 |
| SO 查看 Timesheet | Sale Order | SO 需增加區塊顯示關聯的 Project Timesheet |
| SO 支出報表 | Sale Order | 匯總所有 SO 相關成本，生成支出報表並視覺化顯示 |
| WeChat Timesheet | Timesheet | WeChat Mini App 支持填寫 Timesheet，並同步至 Odoo |

## **4. 限制與假設**
- 本次客製化 **不會影響** Odoo 既有的核心業務邏輯。
- 新增的關聯字段 **不會設為必填**，以保持靈活性。
- **報表生成過程不會影響系統性能**，計算應在合理時間內完成。

## **5. 預期輸出**
- **更新的 Odoo 模組**，包含所有新增的關聯字段與視覺化功能。
- **支出報表**，允許在 SO 內查看綜合成本。
- **WeChat Mini App 支持 Timesheet**，並與 Odoo 同步。

---
本需求文件根據 **Odoo 客製化開發計劃** 所列範圍編寫，如有進一步變更，請更新本文件。
